<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title>内存方式引用ASQL</title>
</head>

<body>
<div align="center"><center>

<table border="0" width="90%" cellspacing="0" cellpadding="0">
  <tr>
    <td width="100%"><p align="center"><strong>内存方式引用ASQL</strong></p>
    <p>　</p>
    <p><font size="3"><span style="font-size: 12px">DWORD tsCallAsqlSvrM(HANDLE 
    hConnect,LPCSTR szAsqlScript, LPVOID lpRsutMem, LPDWORD lpdwLen，LPSTR szInstResult，DWORD 
    dwInstResultSize);</span></font></p>
    <p>　</p>
    <b><p><font size="3"><span style="font-size: 12px">功能：</span></font></b></p>
    <p><font size="3"><span style="font-size: 12px">以内存方式给ASQL脚本进行ASQL请求。如果运算结果有文件性内容，则有两种办法，一种办法是保持一个与Windows 
    NT的连接，将用户的工作目录映射成自己的一个盘符；另一种办法是通过TreeSVR的文件传输支持取回运算结果。</span></font></p>
    <p><font size="3"><span style="font-size: 12px">lpRsutMem是为了接收在ASQL运算过程中由服务器发回来的数据，这些数据通常由ASQL的动作函数，如webprint(),webstream(),mvewno()等产生。比如mvewno()，它负责向客户端传回满足条件的记录号，每个记录号为一个长整数。</span></font></p>
    <p><font size="3"><span style="font-size: 12px">ASQL服务的执行情况在szInstResult中，如果成功的话，它通常应是”ERR:0” 
    ，执行错误的话，这里面放的是出错信息。</span></font></p>
    <p><font size="3"><span style="font-size: 12px">sprintf(szInstResult, &quot;ERR:%d 
    INF:%s\n%s\nXEXP:%s&quot;, \</span></font></p>
    <p><font size="3"><span style="font-size: 12px">ERR:ASQL错误号 \</span></font></p>
    <p><font size="3"><span style="font-size: 12px">ASQL错误信息, \</span></font></p>
    <p><font size="3"><span style="font-size: 12px">ASQL错误附属信息, \</span></font></p>
    <p><font size="3"><span style="font-size: 12px">表达式错误信息 {表达式错误附属信息}</span></font></p>
    <p><font size="3"><span style="font-size: 12px">);</span></font></p>
    <p><font size="3"><span style="font-size: 12px">dwInstResultSize最小应为256字节，以容纳ASQL执行结果。</span></font></p>
    <p>　</p>
    <b><p><font size="3"><span style="font-size: 12px">参数：</span></font></p>
    </b><blockquote>
      <p><font size="3"><span style="font-size: 12px">szAsqlScript：脚本字符串，以尾0结束</span></font></p>
      <p><font size="3"><span style="font-size: 12px">lpRsutMem：存放长大结果的缓冲区</span></font></p>
      <p><font size="3"><span style="font-size: 12px">dwLen：缓冲区大小</span></font></p>
      <p><font size="3"><span style="font-size: 12px">szInstResult:立即结果。为一指向字符缓冲区指针。</span></font></p>
      <p><font size="3"><span style="font-size: 12px">dwInstResultSize：立即结果缓冲区大小</span></font></p>
    </blockquote>
    <p>　</p>
    <b><p><font size="3"><span style="font-size: 12px">返回：</span></font></p>
    </b><blockquote>
      <p><font size="3"><span style="font-size: 12px">1:完整结果</span></font></p>
      <p><font size="3"><span style="font-size: 12px">2：不完整</span></font></p>
      <p><font size="3"><span style="font-size: 12px">3：不成功</span></font></p>
      <p><font size="3"><span style="font-size: 12px">tsGetLastError()可获得出错信息。</span></font></p>
    </blockquote>
    </td>
  </tr>
</table>
</center></div>
</body>
</html>
