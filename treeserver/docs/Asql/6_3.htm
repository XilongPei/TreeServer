<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>数据变动日志撰写规则</title>
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
</head>

<body>
<div align="center"><center>

<table border="0" cellpadding="2" width="90%">
  <tr>
    <td width="100%"><p align="center"><span style="font-size: 12px"><b>数据变动日志撰写规则</b></span></p>
    <ol style="font-size: 12px">
      <li><span style="font-size: 12px">数据变动码规定</span></li>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(1)增加操作'A'</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">DBS=表名<br>
      FIELD=域列表<br>
      DATA=新内容`新内容`新内容`......</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(2)修改操作'M'</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">DBS=表名<br>
      FIELD=主关键字名`被修改过的域名列表<br>
      DATA=主关键字`域1旧内容`域1新内容`域2......<br>
      GRADE=主关键字域数<br>
      修改记录内容</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(3)主关键字修改'K'</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">DBS=表名<br>
      FIELD=主关键字名<br>
      DATA=主关键字`新的主关键字<br>
      对记录的序号修改</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(4)物理删除'D'</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">DBS=表名<br>
      FIELD=主关键字名<br>
      DATA=主关键字<br>
      对记录作物理删除</span></p>
      <li><span style="font-size: 12px">其他说明</span></li>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(1) 文件标识 “ASQL_LOGv3.0.”</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(2) 文件索引性信息段：[SUMMARY]</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">例:</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">199501=00000000000000 <br>
      199502=0000000000000<br>
      199503=00000000000000<br>
      199504=00000000000000<br>
      199505=0000000000000<br>
      199506=00000000000000<br>
      199507=00000000000000<br>
      199508=00000000000362<br>
      199509=00000000000000<br>
      199510=00000000000000<br>
      199511=00000000000000<br>
      199512=00000000000000</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">以月为单位，记录信息在日志中的段偏移。</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">等号前为年月，后边为偏移量，在查找时提高查找速度。</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(3) 最后操作时间(年月日) 
      OPTIME=19950817 </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(4) 最后写入时间(年月日) 
      ETIME=19950817 </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(5) 开始写入时间(年月日) 
      STIME=19950711 </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(6) 具体内容,[年月]为段名 
      [199508] </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(7) 操作类型 T=M </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(8) 操作者 O=U </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(9) 操作时间 H=19958A:3= </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">时间:4字节年,月日时分秒均为1字节为‘0’开始的数字或符号，即该数字值＋ASCII码的‘０’构成的字符。</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(10)操作数据库 B=SUB0</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(11)域列表 F=CODE`SEX </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">域列表:主关键字`域列表</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(12)级别 G=1</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">级别:主半键字域数</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">数据变动日志是用来维护数据库的，在用来恢复本地数据库时，所有日志内容都是有用的，在用来维护上级数据库时，只需部分日志的内容，凡有G-M 
      ，则该段日志需上报，就是说，构成日志上报的标记是G=M 
      。上报标记与基本集的MOD 域的标记相一致。</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(13)数据 D=230910000200022`1`2 </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">数据:主关键字`旧`新</span></p>
      <li><span style="font-size: 12px">数据变动日志撰写实例</span></li>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(1) 记录添加（Ａ）：</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">记录啬加记下新增记录的序号及各域的内容。例：</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">ETIME=19950817 <br>
      STIME=19950711 </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">[199508] </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">T=A <br>
      O=U <br>
      H=19958A:3= <br>
      B=SUB0 <br>
      F=CODE`NAME`SEX` <br>
      G=1 <br>
      D=230910000200022`杨子云`1</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(2) 数据项修改（Ｍ）</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">记录操作日期，操作者，操作类型和操作内容。操作内容包括序号，原</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">内容和新内容。性别变动数据变动日志的例子如下：</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">ETIME=19950817 <br>
      STIME=19950711 </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">[199508] </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">T=M <br>
      O=U <br>
      H=19958A:3= <br>
      B=SUB0 <br>
      F=CODE`SEX <br>
      G=1 <br>
      D=230910000200022`1`2 </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">在D后边是序号，在该序号下，后边是该序号修改前的内容，紧接是修改后的新内容。所对应域的描述在F 
      关键字后边。</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">在数据修改中大量的是相关项修改，因此采用以上的描述方法。</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(3) 序号修改（Ｋ）</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">序号修改只需记录操作类型，操作者、原序号和新序号。例子如下所示：</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">ETIME=19950817 <br>
      STIME=19950711 </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">[199508] </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">T=K <br>
      O=U <br>
      H=19958A:3= <br>
      B=SUB0 <br>
      F=CODE <br>
      G=1<br>
      D=230001011120002`230001011120001;</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">每组序号用‘`’（即键盘左上角键）分隔</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">(4) 记录删除（Ｄ）</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">记录删除只需记下删除记录的序号。例：</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">ETIME=19950817 <br>
      STIME=19950711 </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">[199508] </span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">T=D <br>
      O=U <br>
      H=19958A:3= <br>
      B=SUB0 <br>
      F=CODE <br>
      G=1 <br>
      D=230910000200022 　　　</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">记录删除的物理过程是先做修改再做删除，并且是先做逻辑删除，做完年统后再做物理删除。做物理删除是就同时把删除记录放到删除库中。因为在做删除时在数据变动日志中只有删除的记录号。</span></p>
      <p ALIGN="JUSTIFY"><span style="font-size: 12px">数据变动日志中的删除只作为上报或数据库变动的记录，不作为恢复的依据，如需恢复则和删除库相结合。在作物理删除时写 
      删除的变动日志, 在作逻辑删除时不做.</span></p>
    </ol>
    </td>
  </tr>
</table>
</center></div>
</body>
</html>
